name: ðŸ›¡ï¸ The Shield Protocol: Auto-Governance

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  judicial-review:
    name: âš–ï¸ Judicial Review (æ†²æ³•å¯©æŸ¥)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install Dependencies
        run: npm install

      - name: ðŸ›¡ï¸ Verify Protocol Compliance (åˆè¦æ€§é©—è­‰)
        run: |
          echo "ðŸ” Checking Agent integrity and schema compliance..."
          # æ­¤è™•è¯å‹•æ‚¨çš„ verify é‚è¼¯ï¼Œè‹¥å¤±æ•—å‰‡è§¸ç™¼ä¸‹æ–¹çš„æ‡²ç½°
          npm test || echo "STATUS=MALFUNCTION" >> $GITHUB_ENV

      - name: ðŸ§¨ Execute Automatic Slashing (è‡ªå‹•åŸ·æ³•)
        if: env.STATUS == 'MALFUNCTION'
        env:
          RPC_URL: ${{ secrets.RPC_URL }}
          PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}
          BOT_ID: ${{ github.event.pusher.name }} # æ¨¡æ“¬è­˜åˆ¥è§¸ç™¼è€…ç‚º BotID
        run: |
          echo "ðŸš¨ Protocol Violation Detected! Executing Slash on $BOT_ID"
          node punish.js
